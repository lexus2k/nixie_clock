<head><meta http-equiv="Content-Type" content="text/html;charset=ISO-8859-1"> </head>
<html><body>
<div style="border:1px solid #000;padding: 12px">
<form method='POST' action='/config'>
<b>Wifi:</b><br>
ssid: <input type='text' name='ssid' maxlength='32' value=''><br>
password: <input type='password' name='psk' value='********' maxlength='32'><br>
<br><b>Time:</b><br>
<div id='current_dt'></div><br>
Date: <input type='date' name='set_date'><br>
Time: <input type='time' name='set_time'><br>
<br><input type='submit' value='Update'>
</form>
</div>
<br>
<div style="border:1px solid #000;padding: 12px">
<form name='upgrade'>
<br><b>Fw update</b><br>
<input type='file' name='file'>
<progress name='progress' min="0" max="100" value="0" style='display: none;'>0% complete</progress><br>
<br><input type='button' value='Upgrade' onclick='return on_fw_upload(this.form);'>
</form>
</div>
<script type="text/javascript">
function httpGet(theUrl, callback)
{
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.open( "GET", theUrl, true );
    xmlHttp.addEventListener("load", function(e)
    {
        if (this.status == 200) {
            callback(this.responseText);
        };
    } );
    xmlHttp.send( null );
}
function on_fw_upload(form)
{
  var fr = new FileReader();
  fr.onload = function()
  {
    console.log(fr.result);
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/fwupdate', true);
    // Listen to the upload progress.
    var progressBar = document.querySelector('progress');
    progressBar.style.visibility = true;
    progressBar.style.display = '';
    progressBar.value = 0;
    progressBar.textContent = progressBar.value;
    xhr.addEventListener("load", function(e)
    {
        if (this.status == 200) {
            alert("The clock is being rebooted...");
        } else {
            alert("Flash failed: " + this.responseText);
        };
    } );
    xhr.addEventListener("error", function(e)
    {
        alert("Request failed");
    } );
    xhr.upload.onprogress = function(e)
    {
        if (e.lengthComputable)
        {
            progressBar.value = (e.loaded / e.total) * 100;
            progressBar.textContent = progressBar.value; // Fallback for unsupported browsers.
        }
    };

    xhr.send(fr.result);
  }
  fr.readAsArrayBuffer(form.file.files[0]);
  return true;
}

httpGet( "/param?name=ssid", function(v) { document.getElementsByName('ssid')[0].value=v; } );
httpGet( "/param?name=datetime", function(v) { document.getElementById('current_dt').innerHTML=v; } );

</script>
</body></html>
